---
phase: 07-web-application
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sdk/package.json
  - sdk/vite.config.ts
  - sdk/tsconfig.json
  - sdk/index.html
  - sdk/e2e-test.html
  - sdk/app/main.tsx
  - sdk/app/App.tsx
  - sdk/app/index.css
  - sdk/app/context/WalletContext.tsx
  - sdk/app/components/Layout.tsx
  - sdk/app/components/WalletButton.tsx
  - sdk/app/hooks/useWallet.ts
  - sdk/app/views/CredentialWallet.tsx
autonomous: true

must_haves:
  truths:
    - "The Vite dev server starts with React 19, Tailwind CSS v4, and COOP/COEP headers without errors"
    - "Navigating to / shows the Credential Wallet view with auto-loaded demo credentials"
    - "Each credential card displays issuer name, attribute type (Age/Membership), expiration status (active/expired), and a Generate Proof action button"
    - "The wallet connect button in the navigation connects ArgentX or Braavos via get-starknet modal"
    - "Client-side routing works between /, /prove, and /dashboard without full page reloads"
  artifacts:
    - path: "sdk/app/main.tsx"
      provides: "React 19 entry point with createRoot"
    - path: "sdk/app/App.tsx"
      provides: "Router with three lazy-loaded view routes"
    - path: "sdk/app/context/WalletContext.tsx"
      provides: "Shared wallet connection state via React Context"
    - path: "sdk/app/views/CredentialWallet.tsx"
      provides: "Credential display with demo auto-loading and file picker"
    - path: "sdk/app/components/Layout.tsx"
      provides: "Shell with nav links, wallet button, and Outlet"
  key_links:
    - from: "sdk/index.html"
      to: "sdk/app/main.tsx"
      via: "script type=module src"
      pattern: "src=./app/main.tsx"
    - from: "sdk/app/context/WalletContext.tsx"
      to: "sdk/src/wallet.ts"
      via: "SDK connectWallet/disconnectWallet imports"
      pattern: "import.*connectWallet.*from.*src/index"
    - from: "sdk/app/views/CredentialWallet.tsx"
      to: "sdk/src/credentials.ts"
      via: "SDK validateAgeCredential/validateMembershipCredential imports"
      pattern: "import.*validate.*Credential.*from.*src/index"
---

<objective>
Scaffold the React SPA inside the existing sdk/ directory with React 19, Tailwind CSS v4, and react-router-dom v7. Build the Credential Wallet view (WEB-01) with auto-loaded demo credentials and wallet connection via shared React Context.

Purpose: Establishes the application shell, routing, styling, and the first user-facing view. All subsequent views (Proof Generator, Verification Dashboard) build on this scaffold.
Output: Working React SPA at http://localhost:5173 with navigation, wallet connect, and credential display.
</objective>

<execution_context>
@/Users/laitsky/.claude/get-shit-done/workflows/execute-plan.md
@/Users/laitsky/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-web-application/07-RESEARCH.md
@.planning/phases/05-proof-engine-sdk/05-01-SUMMARY.md
@.planning/phases/06-wallet-chain-sdk/06-01-SUMMARY.md
@.planning/phases/06-wallet-chain-sdk/06-02-SUMMARY.md

# Source files to reference
@sdk/package.json
@sdk/vite.config.ts
@sdk/tsconfig.json
@sdk/index.html
@sdk/src/index.ts
@sdk/src/types.ts
@sdk/src/config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React dependencies and update Vite/TypeScript config</name>
  <files>
    sdk/package.json
    sdk/vite.config.ts
    sdk/tsconfig.json
    sdk/index.html
    sdk/e2e-test.html
  </files>
  <action>
    1. Install React and dev dependencies:
       ```bash
       cd sdk
       npm install react@19 react-dom@19 react-router-dom@7
       npm install -D @vitejs/plugin-react@5 tailwindcss@4 @tailwindcss/vite@4
       ```

    2. Update `sdk/vite.config.ts` -- add react() and tailwindcss() plugins BEFORE nodePolyfills():
       ```typescript
       import { defineConfig } from 'vite';
       import react from '@vitejs/plugin-react';
       import tailwindcss from '@tailwindcss/vite';
       import { nodePolyfills } from 'vite-plugin-node-polyfills';
       import path from 'path';

       export default defineConfig({
         plugins: [
           react(),
           tailwindcss(),
           nodePolyfills({
             globals: { Buffer: true, global: true, process: true },
             protocolImports: true,
           }),
           {
             name: 'configure-response-headers',
             configureServer: (server) => {
               server.middlewares.use((_req, res, next) => {
                 res.setHeader('Cross-Origin-Embedder-Policy', 'credentialless');
                 res.setHeader('Cross-Origin-Opener-Policy', 'same-origin');
                 next();
               });
             },
           },
         ],
         resolve: {
           alias: {
             '@noir-lang/acvm_js': path.resolve(
               __dirname, 'node_modules/@noir-lang/acvm_js/web/acvm_js.js',
             ),
             '@noir-lang/noirc_abi': path.resolve(
               __dirname, 'node_modules/@noir-lang/noirc_abi/web/noirc_abi_wasm.js',
             ),
             pino: path.resolve(__dirname, 'src/shims/pino.js'),
           },
         },
         optimizeDeps: {
           exclude: ['@aztec/bb.js'],
         },
         build: {
           target: 'esnext',
         },
         assetsInclude: ['**/*.wasm'],
       });
       ```
       Plugin ordering is critical: react() before tailwindcss() before nodePolyfills() (per research Pitfall 2).

    3. Update `sdk/tsconfig.json` -- add `"jsx": "react-jsx"` to compilerOptions, add `"app/**/*"` to include:
       ```json
       {
         "compilerOptions": {
           "target": "ESNext",
           "module": "ESNext",
           "moduleResolution": "bundler",
           "strict": true,
           "resolveJsonModule": true,
           "esModuleInterop": true,
           "outDir": "dist",
           "declaration": true,
           "sourceMap": true,
           "skipLibCheck": true,
           "jsx": "react-jsx"
         },
         "include": ["src/**/*", "app/**/*"]
       }
       ```

    4. Rename existing `sdk/index.html` to `sdk/e2e-test.html` (preserve E2E test page for debugging).

    5. Create new `sdk/index.html` as the React SPA entry point:
       ```html
       <!DOCTYPE html>
       <html lang="en">
       <head>
         <meta charset="UTF-8" />
         <meta name="viewport" content="width=device-width, initial-scale=1.0" />
         <title>StarkShield</title>
       </head>
       <body>
         <div id="root"></div>
         <script type="module" src="/app/main.tsx"></script>
       </body>
       </html>
       ```

    6. Verify: `cd sdk && npx tsc --noEmit` passes (may have zero .tsx files yet, but config should be valid). Also verify `npx vite --port 5173` starts without plugin errors (Ctrl+C after confirming no crash).
  </action>
  <verify>
    - `cd sdk && npx tsc --noEmit` exits 0
    - `cd sdk && npx vite --port 5173` starts without errors (check first few lines of output)
    - `sdk/e2e-test.html` exists (original E2E page preserved)
    - `sdk/index.html` contains `<div id="root">` and `src="/app/main.tsx"`
  </verify>
  <done>
    Vite dev server starts with React 19, Tailwind CSS v4, and existing COOP/COEP + WASM config. TypeScript config supports JSX. Original E2E test page preserved as e2e-test.html.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build React app shell, wallet context, and Credential Wallet view</name>
  <files>
    sdk/app/main.tsx
    sdk/app/App.tsx
    sdk/app/index.css
    sdk/app/context/WalletContext.tsx
    sdk/app/components/Layout.tsx
    sdk/app/components/WalletButton.tsx
    sdk/app/hooks/useWallet.ts
    sdk/app/views/CredentialWallet.tsx
  </files>
  <action>
    Create the full React application structure inside `sdk/app/`:

    **1. `sdk/app/index.css`** -- Tailwind v4 entry with custom theme:
    ```css
    @import "tailwindcss";
    ```
    That is all -- Tailwind v4 with the Vite plugin needs no config files, no content globs. Custom theme tokens can be added via CSS custom properties if needed.

    **2. `sdk/app/main.tsx`** -- React 19 entry point:
    ```tsx
    import { StrictMode } from 'react';
    import { createRoot } from 'react-dom/client';
    import App from './App';
    import './index.css';

    createRoot(document.getElementById('root')!).render(
      <StrictMode>
        <App />
      </StrictMode>
    );
    ```

    **3. `sdk/app/App.tsx`** -- Router with lazy-loaded views:
    ```tsx
    import { lazy, Suspense } from 'react';
    import { createBrowserRouter, RouterProvider } from 'react-router-dom';
    import { WalletProvider } from './context/WalletContext';
    import Layout from './components/Layout';

    const CredentialWallet = lazy(() => import('./views/CredentialWallet'));
    const ProofGenerator = lazy(() => import('./views/ProofGenerator'));
    const VerificationDashboard = lazy(() => import('./views/VerificationDashboard'));

    const LoadingFallback = () => (
      <div className="flex items-center justify-center py-20 text-gray-400">Loading...</div>
    );

    const router = createBrowserRouter([
      {
        element: <Layout />,
        children: [
          { index: true, element: <Suspense fallback={<LoadingFallback />}><CredentialWallet /></Suspense> },
          { path: 'prove', element: <Suspense fallback={<LoadingFallback />}><ProofGenerator /></Suspense> },
          { path: 'dashboard', element: <Suspense fallback={<LoadingFallback />}><VerificationDashboard /></Suspense> },
        ],
      },
    ]);

    export default function App() {
      return (
        <WalletProvider>
          <RouterProvider router={router} />
        </WalletProvider>
      );
    }
    ```
    NOTE: ProofGenerator and VerificationDashboard do not exist yet -- create placeholder files that export a default component returning a simple `<div>` with the view name. Plans 07-02 and 07-03 will replace these placeholders.

    **4. `sdk/app/views/ProofGenerator.tsx`** (placeholder):
    ```tsx
    export default function ProofGenerator() {
      return <div className="text-gray-400 py-10 text-center">Proof Generator -- coming soon</div>;
    }
    ```

    **5. `sdk/app/views/VerificationDashboard.tsx`** (placeholder):
    ```tsx
    export default function VerificationDashboard() {
      return <div className="text-gray-400 py-10 text-center">Verification Dashboard -- coming soon</div>;
    }
    ```

    **6. `sdk/app/context/WalletContext.tsx`** -- Wallet state provider:
    Follow the Pattern 2 from research. Use `createContext`, share `walletAccount` (WalletAccount | null), `walletState` (WalletState | null), `connecting` (boolean), `error` (string | null), `connect()`, `disconnect()` functions.

    Import from SDK: `import { connectWallet as sdkConnect, disconnectWallet as sdkDisconnect } from '../../src/index';`
    Import WalletAccount type from starknet: `import type { WalletAccount } from 'starknet';`
    Import WalletState from SDK: `import type { WalletState } from '../../src/index';`

    Use React 19 `<WalletContext value={...}>` syntax (not the old `<WalletContext.Provider value={...}>`).

    **7. `sdk/app/hooks/useWallet.ts`** -- Convenience hook:
    ```typescript
    import { useContext } from 'react';
    import { WalletContext } from '../context/WalletContext';

    export function useWallet() {
      const ctx = useContext(WalletContext);
      if (!ctx) throw new Error('useWallet must be used within WalletProvider');
      return ctx;
    }
    ```

    **8. `sdk/app/components/Layout.tsx`** -- App shell:
    - Dark background (`bg-gray-950 text-gray-100 min-h-screen`)
    - Header with "StarkShield" title and nav links (Credentials `/`, Prove `/prove`, Dashboard `/dashboard`)
    - Use `NavLink` from react-router-dom with active state styling (e.g., `text-violet-400` when active, `text-gray-400` when inactive)
    - WalletButton component in the header (right side)
    - `<Outlet />` from react-router-dom for child routes
    - Max width container (`max-w-4xl mx-auto px-4 py-6`)

    **9. `sdk/app/components/WalletButton.tsx`** -- Wallet connect/disconnect:
    - Import `useWallet` hook
    - Show "Connect Wallet" when not connected, "0x1b29...982d" (truncated address) when connected
    - Show connecting spinner/text when `connecting` is true
    - Green dot indicator when connected
    - Truncate address: `addr.slice(0, 6) + '...' + addr.slice(-4)`

    **10. `sdk/app/views/CredentialWallet.tsx`** -- The main view (WEB-01):
    - On mount, auto-load demo credentials from `/credentials/demo_credential.json` and `/credentials/demo_credential_membership.json` via fetch()
    - Parse each credential: extract type (BigInt(credential_type) === 0n ? 'Age' : 'Membership'), issuer name (truncate issuer_id), expiration status (compare expires_at hex to current timestamp), expiration date (convert hex unix timestamp to human-readable date)
    - Display as cards with Tailwind styling:
      - Card: `bg-gray-900 border border-gray-800 rounded-xl p-5`
      - Header: credential display name + attribute type badge
      - Body: issuer (truncated), expiration date, status badge (green "Active" or red "Expired")
      - Footer: "Generate Proof" button that navigates to `/prove` (use `useNavigate` from react-router-dom). Pass credential data via URL state or store in a simple module-level variable for cross-view communication.
    - Include a "Load Credential" button that opens a file picker (`<input type="file" accept=".json" />`) for loading custom credential JSON files
    - Display loading state while fetching demo credentials
    - Display error state if fetch fails
    - Use validateAgeCredential / validateMembershipCredential from SDK to validate loaded credentials and show validation errors if invalid

    NOTE on cross-view credential passing: The simplest hackathon approach is to store selected credential in a module-level variable exported from a shared file (e.g., `app/context/WalletContext.tsx` can also hold credential state, or create a simple `app/store.ts` with `let selectedCredential: CredentialJSON | null = null` and getter/setter). Alternatively, use React Router's `useNavigate('/prove', { state: { credential } })` and `useLocation().state` in ProofGenerator. The navigate+state approach is cleaner.

    Verify that `npx tsc --noEmit` passes and `npx vite --port 5173` serves the SPA with correct routing.
  </action>
  <verify>
    - `cd sdk && npx tsc --noEmit` exits 0
    - `cd sdk && npx vite --port 5173` starts and serves the React SPA at http://localhost:5173
    - All 8 files in sdk/app/ exist and have non-empty content
    - The Credential Wallet view renders with demo credential cards when loaded in browser
  </verify>
  <done>
    React SPA serves at localhost:5173 with three routes (/, /prove, /dashboard). Credential Wallet view auto-loads and displays demo credentials with issuer name, attribute type, expiration status, and "Generate Proof" button. Wallet connection via get-starknet modal works from the header button. Navigation between views works without full page reload.
  </done>
</task>

</tasks>

<verification>
1. `cd sdk && npx tsc --noEmit` passes with zero errors
2. `cd sdk && npx vite --port 5173` starts without plugin conflicts
3. Browser at http://localhost:5173 shows the Credential Wallet view with 2 demo credential cards
4. Each card shows: credential type name, attribute type, issuer (truncated), expiration date, active/expired status, "Generate Proof" button
5. Clicking "Connect Wallet" opens the get-starknet modal (ArgentX/Braavos)
6. Clicking nav links (Credentials, Prove, Dashboard) routes without page reload
7. "Load Credential" button opens a file picker
8. `sdk/e2e-test.html` exists and can be served at /e2e-test.html for debugging
</verification>

<success_criteria>
The React SPA scaffold is fully operational with React 19, Tailwind CSS v4, react-router-dom v7, and the existing COOP/COEP + WASM Vite configuration. The Credential Wallet view displays auto-loaded demo credentials with all WEB-01 required fields. Wallet connection is shared via React Context. Navigation works across all three route paths.
</success_criteria>

<output>
After completion, create `.planning/phases/07-web-application/07-01-SUMMARY.md`
</output>
